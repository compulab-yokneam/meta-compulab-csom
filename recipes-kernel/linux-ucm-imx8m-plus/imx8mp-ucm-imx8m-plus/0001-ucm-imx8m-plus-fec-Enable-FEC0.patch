From b7d54336341f0765642ba264455d8346c8b173fa Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Wed, 11 May 2022 18:35:41 +0300
Subject: [PATCH] ucm-imx8m-plus: fec: Enable FEC0

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 .../boot/dts/compulab/ucm-imx8m-plus-fec.dtsi | 63 +++++++++++++++++++
 .../boot/dts/compulab/ucm-imx8m-plus.dts      |  2 +
 2 files changed, 65 insertions(+)
 create mode 100644 arch/arm64/boot/dts/compulab/ucm-imx8m-plus-fec.dtsi

diff --git a/arch/arm64/boot/dts/compulab/ucm-imx8m-plus-fec.dtsi b/arch/arm64/boot/dts/compulab/ucm-imx8m-plus-fec.dtsi
new file mode 100644
index 000000000000..c65ff296e8c4
--- /dev/null
+++ b/arch/arm64/boot/dts/compulab/ucm-imx8m-plus-fec.dtsi
@@ -0,0 +1,63 @@
+/ {
+
+	reg_phy_reset: regulator-phy-reset {
+                compatible = "regulator-fixed";
+                regulator-name = "phy_rst";
+                pinctrl-names = "default";
+                pinctrl-0 = <&pinctrl_phy_rst>;
+                regulator-min-microvolt = <3300000>;
+                regulator-max-microvolt = <3300000>;
+                gpio = <&gpio5 5 GPIO_ACTIVE_HIGH>;
+                regulator-boot-on;
+                enable-active-high;
+                regulator-always-on;
+        };
+
+};
+
+&iomuxc {
+    pinctrl_phy_rst: phy1rst {
+        fsl,pins = <
+            MX8MP_IOMUXC_SPDIF_EXT_CLK__GPIO5_IO05   0x19
+        >;
+    };
+
+	pinctrl_fec: fecgrp {
+		fsl,pins = <
+			MX8MP_IOMUXC_SD1_CLK__ENET1_MDC			0x3
+			MX8MP_IOMUXC_SD1_CMD__ENET1_MDIO		0x3
+			MX8MP_IOMUXC_SD1_DATA2__ENET1_RGMII_RD0		0x91
+			MX8MP_IOMUXC_SD1_DATA3__ENET1_RGMII_RD1		0x91
+			MX8MP_IOMUXC_SAI1_RXD6__ENET1_RGMII_RD2		0x91
+			MX8MP_IOMUXC_SAI1_RXD7__ENET1_RGMII_RD3		0x91
+			MX8MP_IOMUXC_SAI1_TXC__ENET1_RGMII_RXC		0x91
+			MX8MP_IOMUXC_SAI1_TXFS__ENET1_RGMII_RX_CTL	0x91
+			MX8MP_IOMUXC_SD1_DATA1__ENET1_RGMII_TD0		0x1f
+			MX8MP_IOMUXC_SD1_DATA0__ENET1_RGMII_TD1		0x1f
+			MX8MP_IOMUXC_SAI1_TXD2__ENET1_RGMII_TD2		0x1f
+			MX8MP_IOMUXC_SAI1_TXD3__ENET1_RGMII_TD3		0x1f
+			MX8MP_IOMUXC_SAI1_TXD4__ENET1_RGMII_TX_CTL	0x1f
+			MX8MP_IOMUXC_SAI1_TXD5__ENET1_RGMII_TXC		0x1f
+		>;
+	};
+};
+
+&fec {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_fec>;
+	phy-mode = "rgmii-id";
+	phy-handle = <&ethphy1>;
+	fsl,magic-packet;
+	status = "okay";
+
+	mdio {
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		ethphy1: ethernet-phy@1 {
+			compatible = "ethernet-phy-ieee802.3-c22";
+			reg = <1>;
+			eee-broken-1000t;
+		};
+	};
+};
diff --git a/arch/arm64/boot/dts/compulab/ucm-imx8m-plus.dts b/arch/arm64/boot/dts/compulab/ucm-imx8m-plus.dts
index 1ca21d8f4a2d..bd031e1b8b30 100644
--- a/arch/arm64/boot/dts/compulab/ucm-imx8m-plus.dts
+++ b/arch/arm64/boot/dts/compulab/ucm-imx8m-plus.dts
@@ -1364,3 +1364,5 @@
 &ldb_phy {
 	status = "okay";
 };
+
+#include "ucm-imx8m-plus-fec.dtsi"
-- 
2.17.1

